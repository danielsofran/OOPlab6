        -:    0:Source:C:/Desktop/OOP/lab6/tests.cpp
        -:    0:Graph:C:\Desktop\OOP\lab6\cmake-build-debug-coverage\CMakeFiles\lab6.dir\tests.cpp.gcno
        -:    0:Data:C:\Desktop\OOP\lab6\cmake-build-debug-coverage\CMakeFiles\lab6.dir\tests.cpp.gcda
        -:    0:Runs:1
        -:    1://
        -:    2:// Created by Daniel on 25.03.2022.
        -:    3://
        -:    4:
        -:    5:#include "tests.h"
        -:    6:
        -:    7:class TestDomain : public ITest
        -:    8:{
        -:    9:protected:
        1:   10:    void ctors() override{
        1:   11:        Locatar l1;
        1:   12:        Locatar l2(10, "Ion", 200, "apartament");
        1:   13:        Locatar l3(l2);
        1:   14:    }
        -:   15:
        1:   16:    void getters() override{
        1:   17:        Locatar l2(10, "Ion", 200, "apartament");
       1*:   18:        assert(l2.getTip() == "apartament");
       1*:   19:        assert(l2.getApartament() == 10);
       1*:   20:        assert(l2.getNumeProprietar() == "Ion");
       1*:   21:        assert(l2.getSuprafata() == 200);
        1:   22:    }
        -:   23:
        1:   24:    void setters() override{
        1:   25:        Locatar l1;
       1*:   26:        assert(l1 == Locatar());
        1:   27:        l1.setTip("apartament");
        1:   28:        l1.setApartament(10);
        1:   29:        l1.setNumeProprietar("Ion");
        1:   30:        l1.setSuprafata(200);
       1*:   31:        assert(l1 == Locatar(10, "Ion", 200, "apartament"));
        1:   32:    }
        -:   33:
        1:   34:    void operators() override{
        1:   35:        Locatar l1;
       1*:   36:        assert(l1 == Locatar());
        1:   37:        Locatar l2(10, "Ion", 200, "apartament");
        1:   38:        Locatar l3(l2);
       1*:   39:        assert( l3 != l1);
        1:   40:        l1.setApartament(5);
       1*:   41:        assert(l1 < l2);
       1*:   42:        assert(l1 <= l2);
       1*:   43:        assert(l2 > l1);
       1*:   44:        assert(l2 >= l1);
        1:   45:        std::strstream sout;
        1:   46:        sout<<l2;
        1:   47:        sout>>l2;
       1*:   48:        assert(l3 == l2);
        1:   49:    }
        -:   50:};
        -:   51:
        -:   52:class TestRepository : public ITest{
        -:   53:protected:
        1:   54:    void ctors() override {
        1:   55:        Repository<int> repository;
       1*:   56:        assert(repository.size()==0);
        1:   57:        Repository<int> r1{2};
       1*:   58:        assert(r1.size() == 1);
        1:   59:        Repository<int> r2(r1);
       1*:   60:        assert(r2.size() == 1);
        1:   61:    }
        1:   62:    void add() override{
        1:   63:        Repository<int> repository;
        1:   64:        repository.add(1);
       1*:   65:        assert(repository.size() == 1);
        1:   66:        repository.add(2);
       1*:   67:        assert(repository.size() == 2);
       1*:   68:        try{ repository.add(1); assert(false); }
        1:   69:        catch(RepoException& re) {}
        1:   70:    }
        1:   71:    void find() override{
        1:   72:        Repository<int> repository;
        1:   73:        repository.add(1);
        1:   74:        repository.add(2);
        1:   75:        auto it = repository.find(2);
       1*:   76:        assert(*it == 2);
       1*:   77:        assert( repository.find(2, it+1) == NULL);
        1:   78:        it = repository.find(3);
       1*:   79:        assert(it == nullptr);
        3:   80:        it = repository.find([](const int& a){return !(a&1);});
       1*:   81:        assert(*it == 2);
       2*:   82:        assert(repository.find([](const int& a){return !(a&1);}, NULL, it) == NULL);
        3:   83:        it = repository.find([](const int& a){return a>10;});
       1*:   84:        assert(it == nullptr);
        1:   85:    }
        1:   86:    void remove() override{
        1:   87:        Repository<int> repository;
        1:   88:        repository.add(1);
        1:   89:        repository.add(2);
        1:   90:        repository.remove(2);
       1*:   91:        assert(repository.size() == 1);
       1*:   92:        assert(repository[0] == 1);
       1*:   93:        try {repository.remove(2); assert(false); }
        1:   94:        catch(RepoException& re) {}
        2:   95:        int elem = repository.remove([](const int& x){return x < 2;});
       1*:   96:        assert(elem == 1);
       1*:   97:        assert(repository.size() == 0);
        1:   98:    }
        1:   99:    void methods() override{
        1:  100:        Repository<int> repository;
        1:  101:        repository.add(2);
        1:  102:        repository.add(1);
        1:  103:        repository.sort();
       1*:  104:        assert(repository[0]==1);
       1*:  105:        assert(repository[1]==2);
        2:  106:        repository.sort([](const int& a, const int& b){return a > b;});
       1*:  107:        assert(repository[0]==2);
       1*:  108:        assert(repository[1]==1);
        1:  109:    }
        1:  110:    void getters() override{
        1:  111:        Repository<int> repository;
        1:  112:        int a=1, b=2;
        1:  113:        repository.add(a);
        1:  114:        repository.add(b);
        3:  115:        for(int x : repository){}
        3:  116:        for(int& x : repository){}
        3:  117:        for(const int x: repository){}
        3:  118:        for(const int& x: repository){}
        3:  119:        for(auto x : repository){}
        3:  120:        for(auto& x : repository){}
        3:  121:        for(const auto x: repository){}
        3:  122:        for(const auto& x: repository){}
        1:  123:    }
        -:  124:};
        -:  125:
        -:  126:class TestService : public ITest{
        -:  127:private:
        5:  128:    static int lg(const Service& s) { return s.cend() - s.cbegin(); }
        4:  129:    static void init(Service& s, Locatar& l1, Locatar& l2, Locatar& l3)
        -:  130:    {
        4:  131:        l1 = Locatar {32, "Andi", 200, "apartament"};
        4:  132:        l2 = Locatar {13, "Ioana", 130, "apartament"};
        4:  133:        l3 = Locatar {13, "Ioana", 7, "apartament"};
        4:  134:        s.add(32, "Andi", 200, "apartament");
        4:  135:        s.add(13, "Ioana", 130, "apartament");
        4:  136:        s.add(13, "Ioana", 7, "apartament");
        4:  137:    }
        3:  138:    static bool equals(const Service& s, const Locatar& l1, const Locatar& l2, const Locatar& l3)
        -:  139:    {
        3:  140:        return  *(s.cbegin()) == l1 &&
       6*:  141:                *(s.cbegin()+1) == l2 &&
        6:  142:                *(s.cbegin()+2) == l3;
        -:  143:    }
        -:  144:protected:
        1:  145:    void add() override{
        1:  146:        Service s;
       1*:  147:        assert(lg(s) == 0);
        1:  148:        s.add(32, "Andi", 200, "apartament");
       1*:  149:        assert(lg(s) == 1);
        1:  150:        s.add(13, "Ioana", 130, "apartament");
       1*:  151:        assert(lg(s) == 2);
       5*:  152:        try{ s.add(32, "Andi", 200, "apartament"); assert(false);}
        1:  153:        catch(RepoException& re) {}
        1:  154:    }
        1:  155:    void remove() override{
        1:  156:        Service s;
        1:  157:        s.add(32, "Andi", 200, "apartament");
        1:  158:        s.add(13, "Ioana", 130, "apartament");
        1:  159:        s.remove(32, "Andi", 200, "apartament");
       1*:  160:        assert(lg(s) == 1);
       5*:  161:        try{s.remove(32, "Andi", 200, "apartament"); assert(false); }
        1:  162:        catch(RepoException& re){}
       5*:  163:        try{s.remove(12, "Ioana", 130, "apartament"); assert(false); }
        1:  164:        catch(RepoException& re){}
        1:  165:        s.remove(13, "Ioana", 130, "apartament");
       1*:  166:        assert(lg(s) == 0);
       5*:  167:        try{s.remove(32, "Andi", 200, "apartament"); assert(false); }
        1:  168:        catch(RepoException& re){}
        1:  169:    }
        1:  170:    void methods() override{
        1:  171:        Service s;
        1:  172:        s.add(32, "Andi", 200, "apartament");
        1:  173:        s.add(13, "Ioana", 130, "apartament");
        1:  174:        s.modify(13, "Ioana", 130, "apartament", 13, "Ioana Pir", 130, "apartament");
       1*:  175:        assert(*(s.begin()+1) == Locatar(13, "Ioana Pir", 130, "apartament"));
       9*:  176:        try{s.modify(1, "Ioana", 130, "apartament", 13, "Ioana Pir", 130, "apartament"); assert(false);}
        1:  177:        catch(RepoException&){}
       9*:  178:        try{s.modify(-1, "Ioana", 130, "apartament", 13, "Ioana Pir", 130, "apartament"); assert(false);}
        1:  179:        catch(ValidatorException&){}
       9*:  180:        try{s.modify(1, "Ioana", 130, "apartament", 13, "Ioana Pir", -130, "apartament"); assert(false);}
        1:  181:        catch(ValidatorException&){}
        1:  182:    }
        1:  183:    void find() override{
        1:  184:        Service s;
        1:  185:        Locatar l1, l2, l3;
        1:  186:        init(s, l1, l2, l3);
        1:  187:        Locatar l = s.findApartament(32);
       1*:  188:        assert(l == Locatar(32, "Andi", 200, "apartament"));
       1*:  189:        try{ s.findApartament(23); assert(false);}
        1:  190:        catch (ServiceException& se) {}
        1:  191:        l = s.findApartament(13);
       1*:  192:        assert(l == Locatar(13, "Ioana", 130, "apartament"));
        1:  193:        s.remove(13, "Ioana", 130, "apartament");
        1:  194:        l = s.findApartament(13);
       1*:  195:        assert(l == Locatar(13, "Ioana", 7, "apartament"));
        1:  196:    }
        1:  197:    void filter() override{
        1:  198:        Service s;
        1:  199:        Locatar l1, l2, l3;
        1:  200:        init(s, l1, l2, l3);
        2:  201:        Repository<Locatar> filtrutip{s.filterTip("apartament")};
       1*:  202:        assert(filtrutip.size() == 3);
        1:  203:        Repository<Locatar> filtrusupr{s.filterSuprafata(130)};
       1*:  204:        assert(filtrusupr[0] == l2);
        2:  205:        Repository<Locatar> filtrutip2{s.filterTip("garsoniera1")};
       1*:  206:        assert(filtrutip2.size() == 0);
        1:  207:    }
        1:  208:    void sort() override{
        1:  209:        Service s;
        1:  210:        Locatar l1, l2, l3;
        1:  211:        init(s, l1, l2, l3);
        1:  212:        s.sortNume();
       1*:  213:        assert(equals(s, l1, l2, l3));
        1:  214:        s.sortSuprafata();
       1*:  215:        assert(equals(s, l3, l2, l1));
        1:  216:        s.sortTipSuprafata();
       1*:  217:        assert(equals(s, l3, l2, l1));
        1:  218:    }
        1:  219:    void getters() override{
        1:  220:        Service s;
        1:  221:        Locatar l1, l2, l3;
        1:  222:        init(s, l1, l2, l3);
        4:  223:        for(Locatar x : s){}
        4:  224:        for(Locatar& x : s){}
        4:  225:        for(const Locatar x: s){}
        4:  226:        for(const Locatar& x: s){}
        4:  227:        for(auto x : s){}
        4:  228:        for(auto& x : s){}
        4:  229:        for(const auto x: s){}
        4:  230:        for(const auto& x: s){}
        1:  231:    }
        -:  232:};
        -:  233:
        -:  234:class TestExceptions : public ITest{
        -:  235:protected:
        1:  236:    void ctors() override{
        1:  237:        try {throw MyException("12");}
        1:  238:        catch(MyException& ex){ assert(strcmp(ex.what(), "12")==0);}
        1:  239:        try {throw RepoException("12");}
        1:  240:        catch(RepoException& ex){ assert(strcmp(ex.what(), "12")==0);}
        1:  241:        try {throw ServiceException("12");}
        1:  242:        catch(ServiceException& ex){ assert(strcmp(ex.what(), "12")==0);}
        1:  243:        try {throw InvalidFieldException("12");}
        1:  244:        catch(InvalidFieldException& ex){ assert(strcmp(ex.what(), "12")==0);}
        -:  245:
        1:  246:        ValidatorException ve;
        2:  247:        InvalidFieldException ie("ex");
        3:  248:        vector<InvalidFieldException> vct{ie};
        1:  249:        ValidatorException ve2(vct);
        1:  250:        ValidatorException ve3(ve2);
        1:  251:        MyException me(ve);
        1:  252:        assert(strcmp(me.what(), ve.what()) == 0);
        1:  253:        assert(strcmp(ve3.what(), ve2.what()) == 0);
        1:  254:    }
        1:  255:    void operators() override{
        1:  256:        ValidatorException ve;
        2:  257:        InvalidFieldException ie("ex");
        3:  258:        vector<InvalidFieldException> vct{ie};
        1:  259:        ValidatorException ve2(vct);
        1:  260:        ValidatorException ve3(ve2);
        1:  261:        ve2 + ve3;
        1:  262:        ve2 + ie;
        1:  263:        ve2 + "Eroare la afisare!";
        1:  264:        ve2 += ve3;
        1:  265:        ve2 += ie;
        1:  266:        ve2 += "Eroare la afisare!";
        1:  267:        std::ostrstream out;
        1:  268:        out<<ve2 + "rip";
        1:  269:    }
        -:  270:};
        -:  271:
        -:  272:class TestValidator : public ITest{
        -:  273:protected:
        1:  274:    void methods() override{
        1:  275:        Locatar l(12, "Andrei Mirun", 25, "apartament");
        1:  276:        ValidatorLocatar::validLocatar(l);
       1*:  277:        try {ValidatorLocatar::validApartament(-12);assert(false);}
        1:  278:        catch(InvalidFieldException&){}
       1*:  279:        try {ValidatorLocatar::validSuprafata(-23);assert(false);}
        1:  280:        catch(InvalidFieldException&){}
       3*:  281:        try {ValidatorLocatar::validNume("Dac @"); assert(false);}
        1:  282:        catch(InvalidFieldException&){}
       3*:  283:        try {ValidatorLocatar::validTip("tip2#");assert(false);}
        1:  284:        catch(InvalidFieldException&){}
        1:  285:        Locatar l2(-12, "324324v3 #$#@$", -5, "2783682737sf%R%^");
       1*:  286:        try{ValidatorLocatar::validLocatar(l2);assert(false);}
        1:  287:        catch(ValidatorException& ve) { assert((int)ve == 4); }
        1:  288:    }
        -:  289:};
        -:  290:
        1:  291:void test()
        -:  292:{
        1:  293:    TestDomain().run();
        1:  294:    TestRepository().run();
        1:  295:    TestService().run();
        1:  296:    TestExceptions().run();
        1:  297:    TestValidator().run();
        1:  298:    std::cout<<"Tests done!\n";
        1:  299:}
